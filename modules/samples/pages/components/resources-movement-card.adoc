= Создание карточки учета перемещения техники

В данном примере будет рассмотрен практический пример создания карточки для учета перемещений техники. В основе карточки будет использоваться стандартный компонент карточки библиотеки _{bo}_.

[NOTE]
====
Архив готовой библиотеки карточек, приведенной в данном примере, доступен по xref:ROOT:attachment$cardLibrary.zip[ссылке].
====

== Разработка схемы данных

Прежде всего необходимо определить архитектуру будущей карточки -- это будет отдельная карточка для каждой единицы техники, содержащая название и список перемещений: дата перемещения, ответственный сотрудник, подразделение-получатель и примечание.

[NOTE]
====
Данный пример рассчитан на специалиста, знакомого с методикой разработки схемы карточки и библиотеки карточек. Для получения данной информации обратитесь к разделу xref:solutions:cards/scheme/dev-data-scheme.adoc[Разработка схемы данных карточки].
====

. Создайте новую библиотеку карточек с использованием утилиты _Docsvision CardManager_.
+
В данном случае в параметрах библиотеки достаточно указать _Alias_ и _Названия_.
+
.Создание библиотеку "Simple Library"
image::ROOT:simple-library.png[Создание библиотеку "Simple Library"]
+
. Создайте в данной библиотеке новую карточку.
+
.Для карточки требуются следующие изменения:
* Укажите _Псевдоним_ и _Названия_.
* В поле _Строка активации_ введите значение `clsid:\{16f0201f-589f-465c-9721-f6a571eb9512}` -- идентификатор компонента `xref:BackOffice-WinForms:BaseCardControl_CL.adoc[BaseCardControl]`.
* В поле _Имя типа_ укажите значение `DocsVision.BackOffice.WinForms.BaseCardControl, DocsVision.BackOffice.WinForms, Version=5.0.0.0, Culture=neutral, PublicKeyToken=7148afe997f90519` -- полное название класса, являющегося основной для создаваемой карточки и карточек библиотеки _{bo}_.
* В списке _Режим чтения данных_ выберите значение *_FETCH_CARD_* -- данные карточки будут получены клиентом полностью.
* Установите флаги `*Card can be marked as template*` и `*Instances can be copied*`.
+
.Создание карточки в новой библиотеке
image::ROOT:create-card-in-lib.png[Создание карточки в новой библиотеке]
+
. Добавьте в карточку секцию `MainInfo` -- базовая информация о единице техники.
+
.Для данной секции произведите следующие изменения:
* Укажите _Названия_.
* Выберите тип организации данных (список _Тип_) в секции `*struct*`.
+
.Добавление секции "MainInfo" в карточку
image::ROOT:man-info-section.png[Добавление секции "MainInfo" в карточку]
+
В данную секцию добавьте поле `Name` с типом `unitext`. Данное поле будет представлять название отдельной единицы оборудования.
+
.Добавление поля "Name" в секцию
image::ROOT:name-field.png[Добавление поля "Name" в секцию]
+
. Добавьте в карточку секцию `History` -- содержит историю перемещения техники.
+
.Для данной секции произведите следующие изменения:
* Укажите _Названия_.
* Выберите тип организации данных (список _Тип_) в секции `*table*` (для возможности хранения нескольких элементов).
+
.Добавление секции "History"
image::ROOT:history-section.png[Добавление секции "History"]
+
.В данную секцию требуется добавить следующие поля:
* `Employee` с типом `*refid*`, в котором содержится ссылка на сотрудника, выполнившего перемещение техники. В свойствах поля необходимо указать идентификаторы в полях _Тип, куда ссылаемся (ID)_ (идентификатор _Справочника сотрудников_) и _Раздел, куда ссылаемся (ID)_ (идентификатор секции _Сотрудники_). Дополнительно можно установить флаг `*Обязательное*`.
+
.Добавление поля "Employee"
image::ROOT:employee-field.png[Добавление поля "Employee"]
+
* `Date` с типом `*date*`. Данное поле содержит дату перемещения оборудования.
+
.Добавление поля "Date"
image::ROOT:date-field.png[Добавление поля "Date"]
+
* `Recipient` с типом `*refid*`, в котором содержится ссылка на организацию или подразделение. В свойствах поля необходимо указать идентификаторы в полях `Тип, куда ссылаемся (ID)` (идентификатор _Справочника сотрудников_) и `Раздел, куда ссылаемся (ID)` (идентификатор секции _Подразделения_). Дополнительно можно установить флаг `*Обязательное*`.
+
.Добавление поля "Recipient"
image::ROOT:recipient-field.png[Добавление поля "Recipient"]
+
* `Description` с типом `*string*`. Тестовый комментарий к операции перемещения техники.
+
.Добавление поля "Description"
image::ROOT:description-field.png[Добавление поля "Description"]
+
. Добавить в карточку секции `System`, `Numbers` и `Processes`. Данные секции являются типовыми и могут быть скопированы (операции _Copy_ и _Paste_ из контекстного меню) из схемы карточки типа _Документ_ библиотеки _{bo}_. Если секции создаются методом копирования, необходимо изменить псевдоним секции на начальное значение.
+
После создания схемы, библиотека карточек должна быть загружена на сервер {dv} (см. раздел xref:solutions:cards/scheme/load-scheme.adoc[Загрузка схем карточек в базу данных]).
+
[WARNING]
====
После добавления карточки потребуется перезапуск сервиса {dv} или перезагрузка сервера
====

== Установка параметров карточки в конструкторах

После добавления карточки в базу {dv} необходимо произвести дополнительную настройку карточки при помощи конструкторов {dv}.

. В _Справочнике видов карточек_ откройте созданную библиотеку и карточку и проверьте настройки на соответствие представленному ниже изображению (название карточки и библиотеки может отличаться). Сохраните изменения.
+
.Карточка в справочнике видов карточек
image::ROOT:card-in-kinds-dir.png[Карточка в справочнике видов карточек]
+
. В _Конструкторе состояний_ определите минимум одно состояние, которое будет являться начальным, а также установите доступность операций редактирования.
+
.Карточка в конструкторе состояний
image::ROOT:card-in-layouts-des.png[Карточка в Конструкторе состояний]
+
. В _Конструкторе ролей_ определите роль для карточки (например, Все).
+
.Карточка в конструкторе ролей
image::ROOT:card-in-roles-des.png[Карточка в конструкторе ролей]
+
Установите необходимый уровень доступа для роли к операциям с карточкой в _Матрице доступа_.
+
.Настройки в Матрице доступа
image::ROOT:access-matrix-settings.png[Настройки в Матрице доступа]
+
. В _Конструкторе разметок_ требуется создать разметку, соответствующую содержимому карточки.
+
.Создание разметки для карточки
image::ROOT:create-layout.png[Создание разметки для карточки]
+
`_Название_` -- элемент управления типа _Строка_, _Источником данных_ для которого установлена секция _Основная информация_, а _Поле данных_ -- _Название_.
+
.Свойства элемента управления "Название"
image::ROOT:name-control-properties.png[Свойства элемента управления "Название"]
+
В качестве элемента управления `_Перемещение_` используется _Таблица_, у которой _Источником данных_ установлена секция _История перемещения_.

.Свойства элемента управления "Перемещение"
image::ROOT:movement-control-properties.png[Свойства элемента управления "Перемещение"]

Для данного элемента управления необходимо добавить столбцы: _Дата_, _Сотрудник_, _Получатель_ и _Примечание_. В каждом столбце выбирается соответствующий элемент данных.

.Создание столбцов для элемента управления "Перемещение"
image::ROOT:columns-settings.png[Создание столбцов для элемента управления "Перемещение"]

После сохранения всех настроек появится возможность создать экземпляр новой карточки и заполнить её данными.

.Создание карточки из {wincl}а
image::ROOT:create-valid-card.png[Создание карточки из {wincl}а]
